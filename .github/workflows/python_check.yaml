name: ðŸ Python Workflow

on:
  push:
    paths:
      - 'python/**'

jobs:
  python_checks:
    name: ðŸ’» Python Checks
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v2

      - name: ðŸ Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.x'

      - name: ðŸ“¦ Install dependencies
        run: |
          pip install flake8 mypy black bandit
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: ðŸš¦ Lint Python code
        run: |
          flake8 python --count --statistics
        continue-on-error: false

      - name: ðŸ“ Type check Python code
        run: |
          mypy python
        continue-on-error: false

      - name: ðŸ–Œï¸ Format Python code with Black
        run: |
          black --check --diff python
        continue-on-error: false

      - name: ðŸ”’ Security check with Bandit
        run: |
          bandit -r python
        continue-on-error: false

      - name: ðŸ“‹ Display Results Summary
        if: always()
        run: |
          lint_summary=$(flake8 python --count --statistics 2>&1)
          typecheck_summary=$(mypy python 2>&1)
          format_summary=$(black --check --diff python 2>&1)
          security_summary=$(bandit -r python 2>&1)

          echo "## Linting Summary"
          echo "$lint_summary"
          echo "## Type Checking Summary"
          echo "$typecheck_summary"
          echo "## Formatting Summary"
          echo "$format_summary"
          echo "## Security Summary"
          echo "$security_summary"

          if [ -n "$lint_summary" ] || [ -n "$typecheck_summary" ] || [ -n "$format_summary" ] || [ -n "$security_summary" ]; then
            echo "ðŸ”´ **FAIL: Issues found**"
            [ -n "$lint_summary" ] && echo "### Linting issues:" && echo "$lint_summary"
            [ -n "$typecheck_summary" ] && echo "### Type checking issues:" && echo "$typecheck_summary"
            [ -n "$format_summary" ] && echo "### Formatting issues:" && echo "$format_summary"
            [ -n "$security_summary" ] && echo "### Security issues:" && echo "$security_summary"
            exit 1
          else
            echo "âœ… **PASS: No issues found**"
          fi
