name: 🐍 Python Workflow

on:
  push:
    paths:
      - 'python/**'

jobs:
  python_checks:
    name: 💻 Python Checks
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Checkout repository
        uses: actions/checkout@v2

      - name: 🐍 Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.x'

      - name: 📦 Install dependencies
        run: |
          pip install -r requirements.txt
          pip install flake8 mypy black bandit

      - name: 🚦 Lint Python code
        uses: github/super-linter@v4
        with:
          languages: python
        continue-on-error: false

      - name: 📝 Type check Python code
        uses: actions/setup-python@v2
        with:
          python-version: '3.x'
        run: |
          pip install mypy
          mypy python || echo "::error title=Type checking failed::Type checking issues found"
        continue-on-error: false

      - name: 🖌️ Format Python code with Black
        uses: psf/black@stable
        with:
          args: --check --diff python
        continue-on-error: false

      - name: 🔒 Security check with Bandit
        uses: pyupio/safety@master
        with:
          args: -r requirements.txt
        continue-on-error: false

      - name: 📋 Display Results Summary
        if: always()
        run: |
          lint_summary=$(flake8 python --count --statistics 2>&1)
          typecheck_summary=$(mypy python 2>&1)
          format_summary=$(black --check --diff python 2>&1)
          security_summary=$(bandit -r python 2>&1)

          echo "## Linting Summary"
          echo "$lint_summary"
          echo "## Type Checking Summary"
          echo "$typecheck_summary"
          echo "## Formatting Summary"
          echo "$format_summary"
          echo "## Security Summary"
          echo "$security_summary"

          if [ -n "$lint_summary" ] || [ -n "$typecheck_summary" ] || [ -n "$format_summary" ] || [ -n "$security_summary" ]; then
            echo "🔴 **FAIL: Issues found**"
            [ -n "$lint_summary" ] && echo "### Linting issues:" && echo "$lint_summary"
            [ -n "$typecheck_summary" ] && echo "### Type checking issues:" && echo "$typecheck_summary"
            [ -n "$format_summary" ] && echo "### Formatting issues:" && echo "$format_summary"
            [ -n "$security_summary" ] && echo "### Security issues:" && echo "$security_summary"
            exit 1
          else
            echo "✅ **PASS: No issues found**"
          fi
